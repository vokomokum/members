<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal">
    <div metal:use-macro="view.layout.macros['master']">
        <div metal:fill-slot="content">


<form tal:attributes="action python: '%s/workgroup/%s/edit' % (portal_url, str(wg.id) if wg.id else -1)"
      method="post" tal:condition="wg">

    <h1>Editing Workgroup ${wg.name}</h1>
    
    <tal:block tal:condition="wg.exists">
        <a class="view_link" href="${portal_url}/workgroup/${wg.id}">view this group</a>
        <input type="hidden" name="id" value="${wg.id}"></input>
    </tal:block>    

    <!-- Data -->
    <table class="list" width="100%" id="wg_table">
      <tr>
        <th align="center">Name:</th>
        <td align="center">
            <input type="text" align="left" size="40" name="name"
                   value="${wg.name}" maxlength="255">
            </input>
        </td>
        <td colspan="2"></td> 
      </tr>
      <tr>
        <th align="center" width="50%" colspan="2">Admins:</th>
        <th align="center" width="50%" colspan="2">Members:</th>
      </tr>
      <tr class="list-content">
        <td colspan="2" align="center">
          <select name="leader_id" size="1" tal:define="lid python: str(wg.leader_id)">
            <tal:block tal:repeat="pm view.possible_members">
                <option tal:condition="python: str(pm.mem_id) == lid"
                        tal:content="pm.fullname()" selected="selected"
                        value="${pm.mem_id}">
                </option>
                <option tal:condition="python: str(pm.mem_id) != lid"
                        tal:content="pm.fullname()" value="${pm.mem_id}">
                </option>
            </tal:block>
          </select>
        </td>
        <td colspan="2" align="center">
            <small>Hold Ctrl while (de)selecting members.</small>
            <select name="wg_members" id="wg_members"
                    size="${python:len(view.possible_members)}"
                    multiple="multiple">
                <tal:block tal:repeat="pm view.possible_members">
                    <option tal:condition="python:pm in wg.members" tal:content="pm.fullname()" value="${pm.mem_id}" selected="selected"></option>
                    <option tal:condition="python:pm not in wg.members" tal:content="pm.fullname()" value="${pm.mem_id}"></option>
                </tal:block>
            </select>
        </td>
      </tr>
      <tr>
        <th align="center" colspan="4">Description:</th>
      </tr>
      <tr>
        <td colspan="4" align="center"><textarea tal:content="wg.desc" rows="8" cols="80" name="desc"></textarea></td>
      </tr>
    </table>

    <!-- Submit -->
    <table width="80%">
        <tr align="center">
            <td width="80%"></td>
            <td width="20%" align="center">
                <button type="submit" title="save" value="save" name="action">
                    <img src="${portal_url}/static/img/icons/save.png"/>
                </button>
                <button tal:condition="wg.exists" type="image" title="delete" value="delete" name="action">
                    <img src="${portal_url}/static/img/icons/delete.gif"/>
                </button>
            </td>
        </tr>
    </table>

</form>



<tal:block tal:condition="wg">
  <tal:block tal:condition="wg.exists">
    <h2>Tasks in this workgroups:</h2>

    <table class="list" align="center">
        <tr>
            <th>Task</th>
            <th>active</th>
        </tr>
        <!-- edit existing tasks form -->
        <tr tal:repeat="t wg.tasks" class="list-content">
            <form action="${portal_url}/workgroup/${wg.id}/edit" method="post">
                <td tal:content="t"></td>
                <td>
                    <tal:block tal:condition="t.active">
                        <span>yes</span>
                        <button type="submit" value="toggle-task-activity" name="action">no</button>   
                    </tal:block>
                    <tal:block tal:condition="not t.active">
                        <span>no</span>
                        <button type="submit" value="toggle-task-activity" name="action">yes</button>   
                    </tal:block>
                </td>
                <td>
                    <div align="center">
                        <button type="image" title="delete" value="delete-task" name="action">
                            <img src="${portal_url}/static/img/icons/delete.gif"/>
                        </button>
                        <input type="hidden" value="${t.id}" name="task_id"></input>
                    </div>
                </td>
            </form>
        </tr>
        <!-- new task form -->
        <tr class="list-content">
            <form action="${portal_url}/workgroup/${wg.id}/edit" method="post">
                <td>
                    <input type="text" size="60" name="task_label"></input>
                </td>
                <td/>
                <td>
                    <button type="submit" class="add_button" value="add-task" name="action">Create new task</button>
                </td>
            </form>
        </tr>
    </table>
  </tal:block>
</tal:block>



        </div>
    </div>
</html>
