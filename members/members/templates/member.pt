<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal">
    <div metal:use-macro="view.layout.macros['master']">
        <div metal:fill-slot="content">


    <h1>${m.fullname}</h1>

    <div id="action-box">
        <a tal:condition="view.user_can_edit" class="edit-link" href="${portal_url}/member/${m.mem_id}/edit">edit this member</a>
        <a tal:condition="view.user_can_edit" class="reset-link" href="${portal_url}/reset-pwd?mem_id=${m.mem_id}">send reset-password email</a>
    </div>
   
    <table class="list" width="100%">
        <tr> 
            <th>Name/Email</th>
            <th>Address</th>
            <th>Phones</th>
        </tr>
        <tr class="list-content">
            <td>
                <div>${m.fullname}</div>
                <div>${m.mem_email}</div>
            </td>
            <td>
                <div>${m.addr_street()}</div>
                <div>${m.addr_city()}</div>
            </td>

            <td>
                <div>Home: ${m.mem_home_tel}</div>
                <div>Work: ${m.mem_work_tel}</div>
                <div>Mobile: ${m.mem_mobile}</div>
            </td>
        </tr>
        <tr tal:condition="not:m.mem_active" class="list-content">
            <td align="center" colspan="3" class="warn">This member is not active.</td>
        </tr>
        <tr tal:condition="m.mem_enc_pwd == ''" class="list-content">
            <td align="center" colspan="3" class="warn">This member has yet to set a password.</td>
        </tr>
        <tr tal:condition="view.user.mem_admin and m.mem_adm_comment != ''" class="list-content">
            <td colspan="3" align="center">
                <span class="warn">Admin-comments:</span>
                <span tal:content="m.mem_adm_comment"></span>
            </td>
        </tr>
    </table>


    <h2>Workgroups</h2>

    <table class="list" width="100%">
        <tr>
            <th width="50%">... is a member in:</th>
            <th width="50%">... coordinates:</th>
        </tr>
        <tr>
            <td class="list-content">
                <div tal:condition="not m.workgroups" class="warn" 
                    tal:content="python: m.fullname + ' is not member of any workgroup.'">
                </div>
                <tal:block tal:repeat="wg m.workgroups">
                    <a href="${portal_url}/workgroup/${wg.id}">${wg.name}</a>
                    <span tal:condition="not repeat.wg.end">,</span>
                </tal:block>
            </td>
            <td class="list-content">
                <tal:block tal:repeat="wg m.led_workgroups">
                    <a href="${portal_url}/workgroup/${wg.id}">${wg.name}</a>
                    <span tal:condition="not repeat.wg.end">,</span>
                </tal:block>
            </td>
        </tr>
    </table>

    <h2>Assigned Shifts</h2>

    <table class="list" align="center" tal:condition="assigned_shifts">
        <tr>
            <th>Task</th>
            <th>Month</th>
            <th>Workgroup</th>
        </tr> 
        <tr class="list-content" tal:repeat="s assigned_shifts">
            <td>${s.task}</td>
            <td><a href="${portal_url}/workgroup/${s.workgroup.id}/shifts/${s.year}/${s.month}">${s.month}/${s.year}</td>
            <td><a href="${portal_url}/workgroup/${s.workgroup.id}">${s.workgroup}</a></td>
        </tr>
    </table>
    <div tal:condition="not assigned_shifts" class="info">
        No assigned shifts.
    </div>

    <h2>Worked Shifts</h2>

    <table class="list" align="center" tal:condition="worked_shifts">
        <tr>
            <th>Task</th>
            <th>Month</th>
            <th>Workgroup</th>
        </tr> 
        <tr class="list-content" tal:repeat="s worked_shifts">
            <td>${s.task}</td>
            <td><a href="${portal_url}/workgroup/${s.workgroup.id}/shifts/${s.year}/${s.month}">${s.month}/${s.year}</td>
            <td><a href="${portal_url}/workgroup/${s.workgroup.id}">${s.workgroup}</a></td>
        </tr>
    </table>
    <div tal:condition="not worked_shifts" class="info">
        No worked shifts.
    </div>

    <tal:block tal:condition="python: view.user.mem_id == m.mem_id or view.user.mem_admin or 'Finance' in view.user.workgroups">
    <h2>Transactions</h2>

    <table class="list" align="center" tal:condition="transactions">
        <tr>
            <th>Amount</th>
            <th>Type</th>
            <th>Date</th>
            <th>Late</th>
        </tr> 
        <tr class="list-content" tal:repeat="t transactions">
            <td><small>EUR</small> ${python:round(t.amount,2)}</td>
            <td>${t.ttype}</td>
            <td>${t.date.date()}</td>
            <td>
                <span tal:condition="t.late">Yes</span>
                <span tal:condition="not t.late">No</span>
            </td>
        </tr>
    </table>
    <div tal:condition="not transactions" class="info">
        No transactions.
    </div>
    </tal:block>
    

        </div>
    </div>
</html>
