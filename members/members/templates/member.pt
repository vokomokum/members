<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:metal="http://xml.zope.org/namespaces/metal"
      xmlns:tal="http://xml.zope.org/namespaces/tal">
    <div metal:use-macro="view.layout.macros['master']">
        <div metal:fill-slot="content">


    <h1>${m.fullname}</h1>

    <div id="action-box">
        <a tal:condition="view.user_can_edit" class="edit-link" href="${portal_url}/member/${m.mem_id}/edit">edit this member</a>
        <a tal:condition="view.user_can_edit" class="reset-link" href="${portal_url}/reset-pwd?mem_id=${m.mem_id}">send reset-password email</a>
    </div>
   
    <table class="list" width="100%">
        <tr> 
            <th>Name/Email</th>
            <th>Address</th>
            <th>Phones</th>
        </tr>
        <tr class="list-content">
            <td>
                <div>${m.fullname} (Voko-ID:${m.mem_id})</div>
                <div><a href="mailto:${m.mem_email}">${m.mem_email}</a></div>
            </td>
            <td>
                <div>${m.addr_street()}</div>
                <div>${m.addr_city()}</div>
            </td>

            <td>
                <div>Home: ${m.mem_home_tel}</div>
                <div>Work: ${m.mem_work_tel}</div>
                <div>Mobile: ${m.mem_mobile}</div>
            </td>
        </tr>
        <tr tal:condition="not:m.mem_active" class="list-content">
            <td align="center" colspan="3" class="warn">This member is not active.</td>
        </tr>
        <tr tal:condition="m.mem_enc_pwd == ''" class="list-content">
            <td align="center" colspan="3" class="warn">This member has yet to set a password.</td>
        </tr>
        <tr tal:condition="view.user.mem_admin and m.mem_adm_comment != ''" class="list-content">
            <td colspan="3" align="center">
                <span class="warn">Admin-comments:</span>
                <span tal:content="m.mem_adm_comment"></span>
            </td>
        </tr>
    </table>


    <h2>Workgroups</h2>

    <table class="list" width="100%">
        <tr>
            <th width="50%">... is a member in:</th>
            <th width="50%">... coordinates:</th>
        </tr>
        <tr>
            <td class="list-content">
                <div tal:condition="not m.workgroups" class="warn" 
                    tal:content="python: m.fullname + ' is not member of any workgroup.'">
                </div>
                <tal:block tal:repeat="wg m.workgroups">
                    <a href="${portal_url}/workgroup/${wg.id}">${wg.name}</a>
                    <span tal:condition="not repeat.wg.end">,</span>
                </tal:block>
            </td>
            <td class="list-content">
                <tal:block tal:repeat="wg m.led_workgroups">
                    <a href="${portal_url}/workgroup/${wg.id}">${wg.name}</a>
                    <span tal:condition="not repeat.wg.end">,</span>
                </tal:block>
            </td>
        </tr>
    </table>

    <h2>Shifts</h2>

    <table class="list" align="center" tal:condition="shifts">
        <tr>
            <th>Task</th>
            <th>Month</th>
            <th>Workgroup</th>
            <th>Status</th>
        </tr> 
        <tr class="list-content" tal:repeat="s shifts">
            <td>${s.task}</td>
            <td><a href="${portal_url}/workgroup/${s.workgroup.id}/shifts/${s.year}/${s.month}">${s.month}/${s.year}</td>
            <td><a href="${portal_url}/workgroup/${s.workgroup.id}">${s.workgroup}</a></td>
            <td>${s.state}</td>
        </tr>
    </table>
    <div tal:condition="not shifts" class="info">
        No shifts.
    </div>

    <tal:block tal:condition="python: view.user.mem_id == m.mem_id or view.user.mem_admin or 'Finance' in view.user.workgroups or 'Membership' in view.user.workgroups">
    <h2>Transactions</h2>

    <table class="list" align="center" tal:condition="transactions">
        <tr class="list-content">
            <td></td>
            <td class="list-balance" colspan="3">Your balance:</td>
            <td class="list-balance"><small>EUR</small>&nbsp;${python:round(m.balance,2)}</td>
        </tr>
        <tr>
            <th>Type</th>
            <th>Date</th>
            <th>Comment</th>
            <th>Late</th>
            <th>Amount</th>
        </tr> 
        <tr class="list-content" tal:repeat="t transactions">
            <td tal:condition="t.ttype.name != 'Order Charge'">${t.ttype}</td>
            <td tal:condition="t.ttype.name == 'Order Charge'">
                Charge for Order:
                <a href="http://order.vokomokum.nl/cgi-bin/adm_view_memord.cgi?order_no=${t.order.id}&amp;Member=${m.mem_id}"
                   title="Click to see the details of this order (you might need to login).">${t.order}</a>
            </td>
            <td>${t.date.date()}</td>
            <td>${t.comment}</td>
            <td>
                <span tal:condition="t.late">Yes</span>
                <span tal:condition="not t.late">No</span>
            </td>
            <td class="list-amount"><small>EUR</small>&nbsp;${python:round(t.amount,2)}</td>
        </tr>
        
    </table>
    <div tal:condition="not transactions" class="info">
        No transactions.
    </div>
    </tal:block>
 
    <tal:block tal:condition="python: view.user.mem_id == m.mem_id or view.user.mem_admin or 'Finance' in view.user.workgroups or 'Membership' in view.user.workgroups">
    <tal:block tal:condition="old_orders">
        <h2>Orders before Nov 2012</h2>

        <table class="list" align="center" tal:condition="old_orders">
            <tr>
                <th>Label</th>
                <th>Amount</th>
            </tr> 
            <tal:block tal:repeat="o old_orders">
            <tr class="list-content" tal:condition="o.amount > 0.0">
                <td>
                    <a href="http://order.vokomokum.nl/cgi-bin/adm_view_memord.cgi?order_no=${o.order.id}&amp;Member=${m.mem_id}">${o.order.label}</a>
                </td>
                <td class="list-amount"><small>EUR</small>&nbsp;${python:round(o.amount,2)}</td>
            </tr>
            </tal:block>
        </table>
    </tal:block>
    <div tal:condition="not old_orders" class="info">
        No orders before Nov 2012.
    </div>
    </tal:block>
    
   

        </div>
    </div>
</html>
